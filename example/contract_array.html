<!DOCTYPE html>
<html>

<head>
<script type="text/javascript" src="../dist/lemo-client.js"></script>
<script type="text/javascript">

    var LemoClient = require('lemo-client');
    var lemoClient = new LemoClient();
    lemoClient.setProvider(new LemoClient.providers.HttpProvider("http://localhost:8545"));

    // source is in contract_array.sol
    var compiled = {
        "abi": [{"constant":true,"inputs":[{"name":"a","type":"uint256[]"},{"name":"b","type":"uint256"}],"name":"take","outputs":[{"name":"d","type":"uint256"}],"payable":false,"stateMutability":"pure","type":"function"}],
        "bin": "608060405234801561001057600080fd5b5060f68061001f6000396000f300608060405260043610603e5763ffffffff7c0100000000000000000000000000000000000000000000000000000000600035041663f459240081146043575b600080fd5b348015604e57600080fd5b5060408051602060048035808201358381028086018501909652808552609795369593946024949385019291829185019084908082843750949750509335945060a99350505050565b60408051918252519081900360200190f35b6000828281518110151560b857fe5b906020019060200201519050929150505600a165627a7a723058209975d0435fb5015809e5eaa65f7cb9e89b12bbfcbaf6f18b39837595cfbfd1e10029",
        "metadata": {"compiler":{"version":"0.4.24+commit.6ae8fb59"},"language":"Solidity","output":{"abi":[{"constant":true,"inputs":[{"name":"a","type":"uint256[]"},{"name":"b","type":"uint256"}],"name":"take","outputs":[{"name":"d","type":"uint256"}],"payable":false,"stateMutability":"pure","type":"function"}],"devdoc":{"methods":{}},"userdoc":{"methods":{}}},"settings":{"compilationTarget":{"contract_array.sol":"test"},"evmVersion":"byzantium","libraries":{},"optimizer":{"enabled":true,"runs":200},"remappings":[]},"sources":{"contract_array.sol":{"keccak256":"0x815c84b044363f526dc4d1edff682e24075c20af78c8a1783906a4b79463424b","urls":["bzzr://ab4c4d62c816ddde6118475d2248a70470db1faae5fa1f464d4e14d06ac800e6"]}},"version":1}
    };
    var code = '0x' + compiled.bin;
    // contract json abi, this is autogenerated using solc CLI
    var abi = compiled.abi;

    var myContract;

    function createExampleContract() {
        // hide create button
        document.getElementById('create').style.visibility = 'hidden';
        document.getElementById('code').innerText = code;

        // let's assume that coinbase is our account
        lemoClient.lemo.defaultAccount = lemoClient.lemo.coinbase;

        // create contract
        document.getElementById('status').innerText = "transaction sent, waiting for confirmation";
        lemoClient.lemo.contract(abi).new({data: code, gas: 150000}, function (err, contract) {
            if (err) {
                console.error(err);
                return;

            // callback fires twice, we only want the second call when the contract is deployed
            } else if(contract.address){

                myContract = contract;
                console.log('address: ' + myContract.address);

                document.getElementById('status').innerText = 'Mined!';
                document.getElementById('call').style.visibility = 'visible';
            }
        });
    }

    function callExampleContract() {
        // this should be generated
        var param = parseInt(document.getElementById('value').value);

        // call the contract
        var res = myContract.take([0,6,5,2,1,5,6], param);
        document.getElementById('result').innerText = res.toString(10);
    }

</script>
</head>
<body>
    <h1>contract</h1>
    <div id="code"></div>
    <div id="status"></div>
    <div id='create'>
        <button type="button" onClick="createExampleContract();">create example contract</button>
    </div>
    <div id='call' style='visibility: hidden;'>
        <div>var array = [0,6,5,2,1,5,6];</div>
        <div>var x = array[
            <input type="number" id="value" onkeyup='callExampleContract()'></input>
        ];
        </div>
    </div>
    <div id="result"></div>
</body>
</html>

